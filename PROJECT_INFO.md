# ColorDB - Система управления цветами

## Описание проекта

ColorDB - это веб-приложение для управления цветами, их рецептами и аналитики использования. Проект построен на React + TypeScript с использованием Feature-Sliced Design архитектуры.

## Текущие изменения

### Миграция данных входного контроля с localStorage на Firebase

**Проблема**: Данные из входного контроля (эталонные краски и тесты новых красок) сохранялись в localStorage, что не обеспечивало надежное хранение и синхронизацию между устройствами.

**Решение**:

- ✅ Создание файла `src/lib/qualityControl.ts` с функциями для работы с Firebase:
  - `saveReferencePaint()` - сохранение эталонных красок
  - `updateReferencePaint()` - обновление эталонных красок
  - `deleteReferencePaint()` - удаление эталонных красок
  - `getReferencePaints()` - получение списка эталонных красок
  - `saveNewPaintTest()` - сохранение тестов новых красок
  - `deleteNewPaintTest()` - удаление тестов новых красок
  - `getNewPaintTests()` - получение списка тестов новых красок
- ✅ Обновление компонента `IncomingControl.tsx`:
  - Замена localStorage на Firebase для хранения данных
  - Добавление асинхронных операций с обработкой ошибок
  - Добавление индикатора загрузки при получении данных
  - Добавление уведомлений об успешных операциях
  - Обработка офлайн-режима с соответствующими сообщениями
- ✅ Обеспечение надежного хранения данных с синхронизацией между устройствами
- ✅ Добавление обработки ошибок сети и офлайн-режима

### Добавление вкладки "Входной контроль" на странице качества

**Проблема**: Отсутствовала система для управления эталонными красками и тестирования новых красок с расчетом Delta E 2000.

**Решение**:

- ✅ Добавление новых типов в `types.ts`:
  - `ReferencePaint` - для эталонных красок с координатами LAB
  - `NewPaintTest` - для тестирования новых красок с расчетом Delta E 2000
- ✅ Создание компонента `ReferencePaints.tsx` для управления эталонными красками:
  - Добавление, редактирование и удаление эталонов
  - Просмотр детальной информации об эталонах
  - Статусы активный/неактивный для эталонов
  - Хранение координат LAB, поставщика и даты создания
  - Возможность указания даты создания эталона при добавлении
- ✅ Создание компонента `NewPaintTests.tsx` для тестирования новых красок:
  - Выбор эталона для сравнения
  - Автоматический расчет Delta E 2000 при вводе координат
  - Статусы тестов: в ожидании, прошел, не прошел
  - Хранение срока годности и информации о поставщике
- ✅ Создание основного компонента `IncomingControl.tsx`:
  - Статистика по эталонам и тестам
  - Переключение между управлением эталонами и тестированием
  - Локальное хранение данных в localStorage
- ✅ Обновление страницы `QualityControl.tsx`:
  - Добавление вкладки "Входной контроль" с иконкой ClipboardCheck
  - Интеграция с существующими вкладками отклонений и причин
- ✅ Использование существующей функции `calculateDeltaE` из `colorUtils.ts` для расчета Delta E 2000
- ✅ Цветовая индикация результатов тестов:
  - Зеленый: ΔE ≤ 1 (отличное совпадение)
  - Желтый: ΔE ≤ 2 (хорошее совпадение)
  - Красный: ΔE > 2 (плохое совпадение)

**Новые возможности**:

- Управление эталонными красками с координатами LAB
- Возможность указания даты создания эталона при добавлении
- Тестирование новых красок с автоматическим расчетом Delta E 2000
- Визуальная индикация качества совпадения цветов
- Статистика по эталонам и результатам тестов
- Локальное хранение данных с возможностью расширения на Firebase
- Интеграция с существующей системой контроля качества
- Адаптивный интерфейс с модальными окнами
- Система статусов для эталонов и тестов

### Изменение технических требований для причин создания цветов

**Проблема**: Технические требования в причинах создания цветов описывали планируемые характеристики, а не фактически созданный цвет.

**Решение**:

- ✅ Изменение типа `ColorCreationReason` в `types.ts`:
  - Переименование полей: `colorAccuracy` → `actualColorAccuracy`
  - Переименование полей: `lightingConditions` → `actualLightingConditions`
  - Переименование полей: `substrateCompatibility` → `actualSubstrateCompatibility`
  - Переименование полей: `durabilityRequirements` → `actualDurabilityRequirements`
  - Добавление поля `achievedColorValues` для хранения фактически достигнутого цвета в формате LAB
  - Добавление поля `productionNotes` для заметок о процессе создания
- ✅ Обновление модального окна `NewReasonModal.tsx`:
  - Изменение заголовков полей на "Фактическая точность цвета", "Условия освещения при создании"
  - Добавление полей для ввода достигнутого цвета в формате LAB (L, a, b)
  - Добавление поля для заметок о процессе создания
  - Обновление плейсхолдеров и описаний полей
- ✅ Обновление компонента `ColorCreationReasons.tsx`:
  - Изменение отображения технических характеристик на "созданного цвета"
  - Добавление отображения достигнутого цвета в формате LAB
  - Добавление отображения заметок о процессе создания
  - Обновление заголовков и описаний

**Новые возможности**:

- Технические требования теперь описывают фактически созданный цвет, а не планируемый
- Возможность указать достигнутый цвет в формате LAB (L, a, b)
- Заметки о процессе создания цвета с описанием использованных материалов и оборудования
- Более точное отражение реального процесса создания цветов
- Улучшенная документация технических характеристик созданных цветов

### Добавление вкладки "Причины создания цветов" на странице контроля качества

**Проблема**: На странице контроля качества была только вкладка с журналом отклонений, но не было возможности отслеживать причины создания новых цветов.

**Решение**:

- ✅ Добавление нового типа `ColorCreationReason` в `types.ts` с упрощенной структурой для отслеживания причин создания цветов
- ✅ Создание функций для работы с причинами создания цветов в `lib/deviations.ts`:
  - `getColorCreationReasons()` - получение всех причин
  - `saveColorCreationReason()` - сохранение новой причины
  - `updateColorCreationReason()` - обновление причины
  - `deleteColorCreationReason()` - удаление причины
  - `getColorCreationReasonsByColor()` - получение причин для конкретного цвета
- ✅ Создание компонента `ColorCreationReasons.tsx` для отображения списка причин с фильтрацией и поиском
- ✅ Создание модального окна `NewReasonModal.tsx` для добавления новых причин с упрощенной формой
- ✅ Обновление страницы `QualityControl.tsx` с добавлением вкладок:
  - "Журнал отклонений" (существующая функциональность)
  - "Причины создания цветов" (новая функциональность)
- ✅ Добавление статусов: предложено, одобрено, в разработке, завершено, отклонено
- ✅ Добавление технических требований: точность цвета, условия освещения, совместимость с материалами
- ✅ Упрощение интерфейса - убраны типы причин, приоритеты и бизнес-кейсы для фокуса на основной функциональности

**Новые возможности**:

- Отслеживание причин создания новых цветов с описанием в свободной форме
- Система статусов для управления процессом создания цветов
- Технические требования для обеспечения качества цветов
- Фильтрация и поиск по причинам создания цветов
- Интеграция с существующей системой отклонений
- Адаптивный интерфейс с вкладками для удобной навигации
- Полная интеграция с Firebase для хранения данных
- Поддержка офлайн режима с уведомлениями пользователя
- Упрощенный интерфейс без избыточной функциональности

### Мобильная адаптация модального окна NewColorModal

**Проблема**: Модальное окно создания нового цвета не было адаптировано для мобильных устройств, что затрудняло использование на смартфонах и планшетах.

**Решение**:

- ✅ Добавление адаптивных классов для мобильных устройств
- ✅ Изменение компоновки с горизонтальной на вертикальную для мобильных устройств
- ✅ Оптимизация отступов и размеров текста для маленьких экранов
- ✅ Улучшение модального окна выбора цвета для мобильных устройств
- ✅ Адаптация высоты контейнеров полок для мобильных устройств
- ✅ Уменьшение размеров шрифтов в ячейках для лучшей читаемости
- ✅ Добавление `truncate` для длинных названий цветов
- ✅ Оптимизация модального окна с ограничением максимальной высоты

**Новые возможности**:

- Адаптивные размеры ячеек (40px на мобильных, 48px на десктопе)
- Вертикальная компоновка стеллажей на мобильных устройствах
- Уменьшенные отступы на мобильных устройствах
- Адаптивные размеры шрифтов и иконок
- Оптимизированное модальное окно с прокруткой
- Лучшая читаемость названий цветов с обрезкой длинного текста
- Адаптивная высота контейнеров полок

### Аналитика неиспользуемых цветов

**Проблема**: Текущая система показывает неиспользуемые цвета только в виде простых алертов без детальной аналитики по месяцам.

**Решение**:

- ✅ Создание нового компонента `UnusedColorsAnalytics.tsx` для детальной аналитики
- ✅ Добавление функций в `lib/analytics.ts` для расчета статистики по месяцам
- ✅ Интеграция аналитики в `AnalyticsDashboard.tsx`
- ✅ Добавление визуализации трендов использования цветов
- ✅ Создание системы уведомлений о неиспользуемых цветах

**Новые возможности**:

- Детальная аналитика использования цветов по месяцам
- Визуализация трендов и паттернов использования
- Система уведомлений о неиспользуемых цветах
- Возможность планирования оптимизации цветовой палитры
- Интеграция с существующей системой аналитики

## Структура проекта

```
src/
├── components/          # UI компоненты
├── contexts/           # React контексты
├── data/              # Статические данные
├── hooks/             # Кастомные хуки
├── lib/               # Утилиты и API
├── pages/             # Страницы приложения
├── types/             # TypeScript типы
└── utils/             # Вспомогательные функции
```

## Технологии

- React 18
- TypeScript
- Tailwind CSS
- Firebase (Firestore)
- Vite
